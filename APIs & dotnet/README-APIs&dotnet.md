# Introduction to Using APIs with .NET
describe here, explain backend webdevelopment

## What is an API?

An API, or Application Programming Interface, allows different software applications to communicate with each other using a set of definitions and protocols. 

You can think of an API as a waiter in a restaurant. You (the user) place an order, the waiter (API) takes your request to the kitchen (system) and brings back the result (data).

### Common Examples of APIs
* Weather services (e.g., OpenWeatherMap)
* Payment gateways (e.g., PayPal, Stripe)
* Social media platforms (e.g., Twitter API, Facebook API)

## What is .NET
.NET is an open-source platform developed by Microsoft that allows you to build applications for web, mobile, desktop, gaming, and more. It provides tools, libraries, and languages (such as C#) to create robust applications. You can learn more about .NET and its capabilities here https://dotnet.microsoft.com/en-us/learn/dotnet/what-is-dotnet 

### Why Learn to Use APIs with .NET?
* To fetch real-time data, such as weather updates or stock prices
* To integrate third-party services, like sending emails or handling payments
* To make your applications more dynamic and interactive

## What is Backend Web Development?

Backend web development refers to the server-side logic and functionality that powers websites and web apps. It involves:
* Processing Requests: Handling data from users or external systems.
* Interfacing with Databases: Storing, retrieving, and managing data efficiently
* Business Logic: Implementing the rules and operations specific to the application’s goals
* APIs: Providing endpoints for frontend applications or other services to interact with

Some commonly used tools for backend web development are .NET, Node.js, Django, and others are commonly used for backend development.

## Let's Get Started

### Setting Up Your Development Environment
1.	Install the .NET SDK (Software Development Kit) from dotnet.microsoft.com.
2.	Use an IDE like Visual Studio or Visual Studio Code
3.	Make sure you have a basic understanding of C# programming. You can find a tutorial here https://dotnet.microsoft.com/en-us/learn/csharp 

## Creating Your First Project

1. Set up a .NET Project

```
dotnet new console -n WeatherApp
cd WeatherApp
```

2. Install Necessary Libraries

Install Newtonsoft.Json for JSON parsing: 

```
dotnet add package Newtonsoft.Json
```

## Creating a Weather App

Now we can get started with creating a weather app that fetches hourly temperature data for the next 7 days using the Open-Meteo API. An important thing to consider when using APIs is what the formatting of its payload is. Most web APIs use JSON formatting, which allows us to parse our retrieved data easily and format it in a more user-friendly fashion. 

You can learn more about JSON formatting here: https://www.w3schools.com/js/js_json_intro.asp. 

## Payload Example

The Open-Meteo API provides a JSON response like the following:

```
{
  "latitude": 52.52,
  "longitude": 13.419998,
  "generationtime_ms": 0.050187110900878906,
  "timezone": "GMT",
  "hourly_units": {
    "time": "iso8601",
    "temperature_2m": "°C"
  },
  "hourly": {
    "time": ["2025-01-17T00:00", "2025-01-17T01:00", ...],
    "temperature_2m": [1.5, 1.3, ...]
  }
}
```

#### Step 0: Locating Our Starting Point

Let's navitage to the file titled `Program.cs`. You should see some autogenerated code that looks like this:

```
// See https://aka.ms/new-console-template for more information
Console.WriteLine("Hello, World!");
```

You can go ahead and delete these lines.

#### Step 1: Importing Necessary Namespaces

Start by importing the namespaces required for our application. These provide the necessary tools to interact with the API, parse the response, and perform asynchronous operations. 

```
using System;                   
using System.Net.Http;         
using System.Threading.Tasks; 
using Newtonsoft.Json.Linq; 
```

* System: This namespace is fundamental for any .NET application. It provides basic classes and functionalities such as console input/output, string manipulation, and data type handling.

* System.Net.Http: This namespace is essential for making HTTP requests, enabling our app to communicate with the Open-Meteo API.

* System.Threading.Tasks: Asynchronous programming is critical for making non-blocking API calls. This namespace provides support for async and await keywords.

* Newtonsoft.Json.Linq: This library simplifies working with JSON data by allowing us to parse the API response into objects we can easily manipulate.

#### Step 2: Setting Up the Main Method

Next, define the entry point of the application using the Main method. This is where we will implement the logic to fetch data from the API and process it.

The `Program` class serves as the starting place where the application begins execution. This is a standard convention in C#, and typically, it contains the `Main` method where we implement the program's logic.

```
class Program
{
    static async Task Main(string[] args) { }
}
```
#### Step 3: Defining the API URL

Define a string inside the `Main` method, that will contain the url of the API. The apiUrl string includes the endpoint and query parameters such as latitude, longitude, and hourly temperature data. Checkout the Open-Meteo API documentation to see how you can change your url to retrieve different data! https://open-meteo.com/en/docs#latitude=45.5088&longitude=-73.5878&current=&minutely_15=&hourly=temperature_2m&daily=&models= 

```
string apiUrl = "https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&hourly=temperature_2m";
```

#### Step 4: Creating an HTTP Client

Create an instance of the HttpClient class to send HTTP requests and receive responses from APIs. Wrapping it in a 'using' statement ensures proper disposal of resources once the client is no longer needed. This is essential for managing memory and network resources effectively in the application.

```
 using (HttpClient client = new HttpClient()) {}
```

#### Step 5: Sending the Request

Inside the `using` block, we can make our GET request to the API.

```
HttpResponseMessage response = await client.GetAsync(apiUrl);
```

The GetAsync method sends a GET request to the API endpoint. The await keyword ensures the app waits for the response without blocking execution.

#### Step 6: Processing the Response

If the response status code indicates success (e.g., 200 OK), read the content as a JSON-formatted string. We want to proccess the response and format all of our data inside the `using` block.

```
if (response.IsSuccessStatusCode)
{
    string json = await response.Content.ReadAsStringAsync();
    var data = JObject.Parse(json);

    // Display entire JSON payload
    Console.WriteLine("Full API Response:");
    Console.WriteLine(json);
}
```

Use JObject.Parse to convert the JSON string into a manipulatable object. At this point you can run your project and see the entire payload from the API response! Presenting the data like this makes it hard for users to understand, and in certain scenarios we may not need to display all of the data we've retrieved.

Run your project by executing the following command in your terminal. Make sure you have navigated to your project directory.
```
dotnet run
```

#### Step 7: Displaying the Data

Extract specific fields (temperature_2m and time) from the JSON object. Then, loop through the data at 24-hour intervals to display a daily summary for the week.

```
// Display 7-day forecast summary
Console.WriteLine("\n7-Day Forecast:");
var temperatures = data["hourly"]["temperature_2m"];
var times = data["hourly"]["time"];

for (int i = 0; i < 168; i += 24) // Display one temperature per day
{
    Console.WriteLine($"Date: {times[i]} - Temp: {temperatures[i]}°C");
}
```

Run the project again, and notice how much more user-friendly the output is now!

#### Step 8: Error Handling

If an API request fails, your application can break without proper error handling. Let's add a simple `else` branch to ensure we are notified of any failures, and handle them accordingly.

if (response.IsSuccessStatusCode)
{
    ...
}else{
    Console.WriteLine("Error: Unable to fetch data.");
}
```

Congrats, you've successfully created your weather app! I encourage you to take a look at the API documentation and play around with what other information you can request. If you're interested in creating a frontend for your application, check the resouces section of this file to learn more!

## More About HTTP

HTTP (HyperText Transfer Protocol) is the protocol used for transmitting data over the web. It enables browsers to request web pages and servers to send back the requested content. It defines how messages are formatted and transmitted, and how web servers and browsers should respond to various commands.

### Types of HTTP Requests

When interacting with APIs, you will commonly encounter several types of HTTP requests, each serving a different purpose:

* GET: Retrieves data from a specified resource (e.g., retrieving weather information).
* POST: Sends data to the server to create a new resource (e.g., submitting form data).
* PUT: Sends data to the server to update an existing resource.
* DELETE: Removes a specified resource from the server.
* PATCH: Partially updates an existing resource.

Each type of request informs the server what action to perform.

### HTTP Response Codes

HTTP response codes indicate the result of an HTTP request. Some common ones include:

# 200 OK: The request was successful, and the server has returned the requested data.
# 201 Created: The resource was successfully created.
# 400 Bad Request: The server cannot process the request due to incorrect syntax.
# 401 Unauthorized: The request lacks valid authentication credentials.
# 404 Not Found: The requested resource could not be found.
# 500 Internal Server Error: The server encountered an error while processing the request.


## Resources
* https://learn.microsoft.com/en-ca/training/paths/build-dotnet-applications-csharp/?WT.mc_id=dotnet-35129-website 
* https://dotnet.microsoft.com/en-us/apps/aspnet 
* https://free-apis.github.io/#/ 
